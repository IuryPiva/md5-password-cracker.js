<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>

  <div id="worker0"></div>
  <div id="worker1"></div>
  <div id="worker2"></div>
  <div id="worker3"></div>
  <div id="worker4"></div>
  <div id="worker5"></div>
  <div id="worker6"></div>
  <div id="worker7"></div>
  <div id="log"></div>

  <script src="jshash-2.2/md5-min.js"></script>
  <script src="chars.js"></script>

  <script>
    function addCommasToInteger(x) {
      x = parseInt(x) + ''
      var rgx = /(\d+)(\d{3})/
      while (rgx.test(x)) {
        x = x.replace(rgx, '$1' + ',' + '$2')
      }
      return x
    }

    window.URL = window.URL || window.webkiURL

    function log(msg, workerId) {
      var prefix = workerId != null
        ? "Worker " + workerId + " says: "
        : "Main page says: "

      var selector = workerId != null
        ? "#worker" + workerId
        : "#log"

      document.querySelector(selector).textContent = prefix + msg
    }


    // var blob = new Blob([document.querySelector('#worker1').textContent])
    // var url = window.URL.createObjectURL(blob)

    var numWorkers = 8
    var charsPerWorker = charsLength / numWorkers

    for (var i = 0; i < numWorkers; i++) {
      var worker = new Worker('worker.js')

      worker.addEventListener('message', function (e) {
        switch (e.data.cmd) {
          case "log":
            log(e.data.data, e.data.id)
            break
          case "setRate":
            log(addCommasToInteger(e.data.data) + " passwords/second", e.data.id)
            break
          default:
            log("Main page doesn't understand command " + e.data.cmd)
            break
        }
      })

      worker.addEventListener('error', function(e) {
        log(['ERROR: Line ', e.lineno, ' in ', e.filename, ': ', e.message].join(''))
      })

      // Set worker settings

      worker.postMessage({ cmd: "setWorkerId", data: i })
      worker.postMessage({ cmd: "setMaxPassLength", data: 5 })
      worker.postMessage({ cmd: "setPassToCrack", data: "7ed21143076d0cca420653d4345baa2f" })

      // Split up work among workers
      var charsStart = i * charsPerWorker
        , charsEnd = charsStart + charsPerWorker
        , queue = chars.slice(Math.floor(charsStart), Math.floor(charsEnd))

      worker.postMessage({ cmd: "performCrack", data: queue })

    }

  </script>

<!-- Livereload -->
<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
</body>
</html>